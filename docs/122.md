# Java æ–‡ä»¶ä¸Šä¼  REST æœåŠ¡

> åŸæ–‡ï¼š [https://javatutorial.net/java-file-upload-rest-service](https://javatutorial.net/java-file-upload-rest-service)

åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘å°†è§£é‡Šå¦‚ä½•æ„å»º Java REST Web æœåŠ¡ä»¥é€šè¿‡ HTTP ä»ä»»ä½•å®¢æˆ·ç«¯ä¸Šè½½æ–‡ä»¶ã€‚

å°†æ–‡ä»¶ä¸Šä¼ åˆ° Web åº”ç”¨ç¨‹åºæ˜¯å½“ä»Šçš„ä¸€é¡¹å¸¸è§ä»»åŠ¡ã€‚ è®¸å¤šæœåŠ¡éƒ½æ”¯æŒåœ¨å…¶ç½‘ç«™ä¸Šä¸Šä¼ å›¾ç‰‡æˆ–æ–‡æ¡£ã€‚ ä½¿ç”¨ Java Web æœåŠ¡ï¼Œè¿™å¾ˆå®¹æ˜“å®ç°ã€‚ é™¤äº† Java Web å®¹å™¨ï¼ˆç”± [Tomcat](http://tomcat.apache.org/)ï¼Œ[GlassFish](http://www.oracle.com/us/products/middleware/cloud-app-foundation/glassfish-server/overview/index.html) æˆ– [JBoss](http://wildfly.org/) ç­‰åº”ç”¨æœåŠ¡å™¨æä¾›ï¼‰ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ [Jersey](https://github.com/jersey) ä½¿å®ƒè¿è¡Œã€‚ é¦–å…ˆï¼Œæˆ‘å°†å‘æ‚¨å±•ç¤ºå¦‚ä½•å®ç° Web æœåŠ¡ï¼Œç„¶åä¸ºæ‚¨æä¾›ä¸¤ä¸ªä½¿ç”¨è¯¥æœåŠ¡çš„å®¢æˆ·ç«¯ç¤ºä¾‹ã€‚

![Java file upload form](img/836922dfb5378127ddf91a02d2fdf2ec.jpg)

Java æ–‡ä»¶ä¸Šä¼ è¡¨æ ¼

## æ„å»ºæ–‡ä»¶ä¸Šä¼  REST æœåŠ¡

è¯¥æ–‡ä»¶é€šè¿‡ HTTP POST ä»¥ç¼–ç ç±»å‹`multipart/form-data`ä»å®¢æˆ·ç«¯æ¨é€åˆ°æˆ‘ä»¬çš„ Web æœåŠ¡ã€‚ è¿™æ ·ï¼Œé™¤äº†æ–‡ä»¶ä¹‹å¤–ï¼Œæ‚¨è¿˜å¯ä»¥å‘ POST è¯·æ±‚æ·»åŠ å¤šä¸ªå‚æ•°ã€‚ è®©æˆ‘ä»¬ä»éœ€æ±‚å¼€å§‹ã€‚ æ‚¨å°†éœ€è¦ Web åº”ç”¨ç¨‹åºæœåŠ¡å™¨ï¼ˆä¾‹å¦‚ Tomcatï¼ŒGlassFish æˆ– JBossï¼‰æ¥éƒ¨ç½²æœåŠ¡ã€‚ å¦å¤–ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ jersey æ¡†æ¶æ¥æ„å»ºæˆ‘ä»¬çš„æœåŠ¡ç«¯ç‚¹ã€‚ è¯·æ³¨æ„ï¼ŒGlassFish 4.x ç‰ˆæœ¬éœ€è¦ jersey ç‰ˆæœ¬ 2 åº“ï¼Œå› æ­¤å¦‚æœä½¿ç”¨ GlassFish 4ï¼Œåˆ™**è¯·åœ¨æ‚¨çš„ POM æ–‡ä»¶ä¸­ä½¿ç”¨ jersey 2.x ä¾èµ–é¡¹**ã€‚

ä¸ºäº†å¿«é€Ÿå‚è€ƒï¼Œæ‚¨å¯ä»¥åœ¨æˆ‘ä»¬çš„ GitHub å­˜å‚¨åº“ä¸­çš„ [https://github.com/JavaTutorialNetwork/Tutorials/tree/master/FileUploaderRESTService](https://github.com/JavaTutorialNetwork/Tutorials/tree/master/FileUploaderRESTService) ä¸‹æ‰¾åˆ°æ•´ä¸ªé¡¹ç›®

æˆ‘å°†åœ¨æ­¤å¤„å‘å¸ƒæ•´ä¸ª POM æ–‡ä»¶ï¼Œä½†æ‚¨éœ€è¦è€ƒè™‘çš„æ˜¯ Jersey ä¾èµ–é¡¹

```java
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
	<modelVersion>4.0.0</modelVersion>

	<groupId>net.javatutorial.tutorials</groupId>
	<artifactId>FileUploaderRESTService</artifactId>
	<version>1</version>
	<packaging>war</packaging>

	<name>File Uploader Rest Service</name>
	<url>https://javatutorial.net</url>

	<properties>
		<project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
	</properties>

	<dependencies>
		<dependency>
			<groupId>com.sun.jersey</groupId>
			<artifactId>jersey-server</artifactId>
			<version>1.8</version>
		</dependency>
		<dependency>
			<groupId>com.sun.jersey</groupId>
			<artifactId>jersey-servlet</artifactId>
			<version>1.17.1</version>
		</dependency>
		<dependency>
			<groupId>com.sun.jersey</groupId>
			<artifactId>jersey-json</artifactId>
			<version>1.8</version>
		</dependency>
		<dependency>
			<groupId>com.sun.jersey.contribs</groupId>
			<artifactId>jersey-multipart</artifactId>
			<version>1.8</version>
		</dependency>
	</dependencies>

	<build>
		<plugins>
			<plugin>
				<groupId>org.apache.maven.plugins</groupId>
				<artifactId>maven-compiler-plugin</artifactId>
				<version>3.1</version>
				<inherited>true</inherited>
				<configuration>
					<source>1.7</source>
					<target>1.7</target>
				</configuration>
			</plugin>
			<plugin>
				<artifactId>maven-war-plugin</artifactId>
				<version>2.3</version>
				<configuration>
					<webXml>src/main/webapp/WEB-INF/web.xml</webXml>
					<webResources>
						<resource>
							<!-- this is relative to the pom.xml directory -->
							<directory>${project.basedir}/src/main/resources
							</directory>
						</resource>
					</webResources>
				</configuration>
			</plugin>
		</plugins>
	</build>

</project>
```

ç°åœ¨æ‹¥æœ‰æ‰€æœ‰å¿…éœ€çš„åº“ï¼Œè®©æˆ‘ä»¬ç»§ç»­å®ç° REST æœåŠ¡ã€‚ ä¸‹é¢çš„ä»£ç ä¸­æœ‰å‡ ä¸ªåœ°æ–¹æˆ‘æƒ³æé†’æ‚¨æ³¨æ„ã€‚ é¦–å…ˆè¯·æ³¨æ„`@Consumes(MediaType.MULTIPART_FORM_DATA)`ä½œä¸ºè¯·æ±‚çš„ç¼–ç ç±»å‹çš„ç”¨æ³•ã€‚ å…¶æ¬¡ï¼Œå¦‚æœæ„¿æ„ï¼Œæ‚¨å¯èƒ½å¸Œæœ›å‘è¯¥æ–¹æ³•æ·»åŠ å…¶ä»–å‚æ•°ã€‚ ä¾‹å¦‚ï¼Œæ‚¨å¯èƒ½è¦åœ¨ä¸Šä¼ æ—¶ä¼ é€’ä¸€äº›æè¿°æˆ–å…¶ä»–æ–‡æœ¬æ•°æ®ã€‚ æœ€åï¼Œå¦‚æœæ‚¨å°è¯•å°†æ–‡ä»¶ä¸Šä¼ åˆ°ä¸å­˜åœ¨çš„ç›®å½•ä¸­ï¼ŒJava å°†æŠ›å‡ºå¼‚å¸¸ã€‚ ä¸ºäº†é¿å…è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘åˆ›å»ºäº†æ–¹æ³•`createFolderIfNotExists(StringdirName)`ã€‚

```java
package net.javatutorial.tutorials.services;

import java.io.File;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.InputStream;
import java.io.OutputStream;

import javax.ws.rs.Consumes;
import javax.ws.rs.POST;
import javax.ws.rs.Path;
import javax.ws.rs.core.Context;
import javax.ws.rs.core.MediaType;
import javax.ws.rs.core.Response;
import javax.ws.rs.core.UriInfo;

import com.sun.jersey.core.header.FormDataContentDisposition;
import com.sun.jersey.multipart.FormDataParam;

/**
 * This example shows how to build Java REST web-service to upload files
 * accepting POST requests with encoding type "multipart/form-data". For more
 * details please read the full tutorial on
 * https://javatutorial.net/java-file-upload-rest-service
 * 
 * @author javatutorial.net
 */
@Path("/upload")
public class FileUploadService {

	/** The path to the folder where we want to store the uploaded files */
	private static final String UPLOAD_FOLDER = "c:/uploadedFiles/";

	public FileUploadService() {
	}

	@Context
	private UriInfo context;

	/**
	 * Returns text response to caller containing uploaded file location
	 * 
	 * @return error response in case of missing parameters an internal
	 *         exception or success response if file has been stored
	 *         successfully
	 */
	@POST
	@Consumes(MediaType.MULTIPART_FORM_DATA)
	public Response uploadFile(
			@FormDataParam("file") InputStream uploadedInputStream,
			@FormDataParam("file") FormDataContentDisposition fileDetail) {

		// check if all form parameters are provided
		if (uploadedInputStream == null || fileDetail == null)
			return Response.status(400).entity("Invalid form data").build();

		// create our destination folder, if it not exists
		try {
			createFolderIfNotExists(UPLOAD_FOLDER);
		} catch (SecurityException se) {
			return Response.status(500)
					.entity("Can not create destination folder on server")
					.build();
		}

		String uploadedFileLocation = UPLOAD_FOLDER + fileDetail.getFileName();
		try {
			saveToFile(uploadedInputStream, uploadedFileLocation);
		} catch (IOException e) {
			return Response.status(500).entity("Can not save file").build();
		}

		return Response.status(200)
				.entity("File saved to " + uploadedFileLocation).build();
	}

	/**
	 * Utility method to save InputStream data to target location/file
	 * 
	 * @param inStream
	 *            - InputStream to be saved
	 * @param target
	 *            - full path to destination file
	 */
	private void saveToFile(InputStream inStream, String target)
			throws IOException {
		OutputStream out = null;
		int read = 0;
		byte[] bytes = new byte[1024];

		out = new FileOutputStream(new File(target));
		while ((read = inStream.read(bytes)) != -1) {
			out.write(bytes, 0, read);
		}
		out.flush();
		out.close();
	}

	/**
	 * Creates a folder to desired location if it not already exists
	 * 
	 * @param dirName
	 *            - full path to the folder
	 * @throws SecurityException
	 *             - in case you don't have permission to create the folder
	 */
	private void createFolderIfNotExists(String dirName)
			throws SecurityException {
		File theDir = new File(dirName);
		if (!theDir.exists()) {
			theDir.mkdir();
		}
	}

}

```

æœ€åï¼Œæˆ‘ä»¬éœ€è¦é…ç½®`web.xml`ä»¥å°†æˆ‘ä»¬çš„ç±»æ³¨å†Œä¸º Web æœåŠ¡å¹¶ä½¿å…¶åœ¨å¯åŠ¨æ—¶è¿è¡Œã€‚

```java
<?xml version="1.0" encoding="UTF-8"?>
<web-app xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns="http://java.sun.com/xml/ns/javaee" xmlns:web="http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"
	xsi:schemaLocation="http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"
	id="WebApp_ID" version="2.5">
	<display-name>net.javatutorial.tutorials.services</display-name>
	<servlet>
		<servlet-name>Jersey REST Service</servlet-name>
		<servlet-class>com.sun.jersey.spi.container.servlet.ServletContainer</servlet-class>
		<init-param>
			<param-name>com.sun.jersey.config.property.packages</param-name>
			<param-value>net.javatutorial.tutorials.services</param-value>
		</init-param>
		<load-on-startup>1</load-on-startup>
	</servlet>
	<servlet-mapping>
		<servlet-name>Jersey REST Service</servlet-name>
		<url-pattern>/rest/*</url-pattern>
	</servlet-mapping>
</web-app>
```

å¥½çš„ï¼ ç°åœ¨ï¼Œæ‚¨å¯ä»¥æ„å»ºå’Œéƒ¨ç½² WAR æ–‡ä»¶ã€‚ å¦‚æœæ‚¨ä½¿ç”¨ä¸Šé¢ä»£ç ä¸­æä¾›çš„å®Œå…¨ç›¸åŒçš„åç§°ï¼Œåˆ™æ‚¨çš„æœåŠ¡ URLï¼ˆå‡è®¾æ‚¨åœ¨`localhost`ä¸Šè¿è¡Œï¼‰å°†æ˜¯ï¼š`http://localhost:8080/FileUploaderRESTService-1/rest/upload`

## æ–‡ä»¶ä¸Šä¼  HTML è¡¨æ ¼

æ‚¨å¯ä»¥ä½¿ç”¨éå¸¸ç®€å•çš„ HTML post è¡¨å•ä½œä¸ºå®¢æˆ·ç«¯å°†æ–‡ä»¶å‘é€åˆ°æœåŠ¡å™¨ã€‚

è¯·æ³¨æ„`multipart/form-data`ä½œä¸ºç¼–ç ç±»å‹çš„ç”¨æ³•ã€‚ æ‚¨è¿˜éœ€è¦æ·»åŠ æ–‡ä»¶ç±»å‹ä¸º`[file]`çš„è¾“å…¥

```java
Choose file to upload<br>
<form action="http://localhost:8080/FileUploaderRESTService-1/rest/upload" method="post" enctype="multipart/form-data">
	<input name="file" id="filename" type="file" /><br><br>
	<button name="submit" type="submit">Upload</button>
</form>
```

å¦‚å‰æ‰€è¿°ï¼Œæ‚¨å¯ä»¥å‘è¯·æ±‚ä¸­æ·»åŠ å…¶ä»–æ•°æ®ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåˆ«å¿˜äº†åœ¨ç½‘ç»œæœåŠ¡ä¸­å¤„ç†å®ƒğŸ™‚

## Java æ–‡ä»¶ä¸Šä¼ å®¢æˆ·ç«¯

æ‚¨å¯ä»¥ä¸º Android æˆ– Java ä¸­çš„ç‹¬ç«‹ç¨‹åºåˆ›å»ºæ–‡ä»¶ä¸Šä¼ å®¢æˆ·ç«¯ã€‚ åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘å°†ä½¿ç”¨ Apache http åº“ï¼Œæ‚¨å°†éœ€è¦ä»¥ä¸‹äº”ä¸ªï¼š

*   commonlog
*   httpclient
*   httpclient cache
*   httpcore
*   httpmime

```java
package net.javatutorial.tutorials.clienst;

import java.io.File;
import java.io.FileInputStream;
import java.io.IOException;

import org.apache.http.HttpEntity;
import org.apache.http.HttpResponse;
import org.apache.http.client.ClientProtocolException;
import org.apache.http.client.methods.HttpPost;
import org.apache.http.entity.mime.MultipartEntity;
import org.apache.http.entity.mime.content.InputStreamBody;
import org.apache.http.impl.client.DefaultHttpClient;
import org.apache.http.params.BasicHttpParams;
import org.apache.http.util.EntityUtils;

/**
 * This example shows how to upload files using POST requests 
 * with encoding type "multipart/form-data".
 * For more details please read the full tutorial
 * on https://javatutorial.net/java-file-upload-rest-service
 * @author javatutorial.net
 */
public class FileUploaderClient {

	public static void main(String[] args) {

		// the file we want to upload
		File inFile = new File("C:\\Users\\admin\\Desktop\\Yana-make-up.jpg");
		FileInputStream fis = null;
		try {
			fis = new FileInputStream(inFile);
			DefaultHttpClient httpclient = new DefaultHttpClient(new BasicHttpParams());

			// server back-end URL
			HttpPost httppost = new HttpPost("http://localhost:8080/FileUploaderRESTService-1/rest/upload");
			MultipartEntity entity = new MultipartEntity();

			// set the file input stream and file name as arguments
			entity.addPart("file", new InputStreamBody(fis, inFile.getName()));
			httppost.setEntity(entity);

			// execute the request
			HttpResponse response = httpclient.execute(httppost);

			int statusCode = response.getStatusLine().getStatusCode();
			HttpEntity responseEntity = response.getEntity();
			String responseString = EntityUtils.toString(responseEntity, "UTF-8");

			System.out.println("[" + statusCode + "] " + responseString);

		} catch (ClientProtocolException e) {
			System.err.println("Unable to make connection");
			e.printStackTrace();
		} catch (IOException e) {
			System.err.println("Unable to read file");
			e.printStackTrace();
		} finally {
			try {
				if (fis != null) fis.close();
			} catch (IOException e) {}
		}
	}

}

```

æ‚¨å°†åœ¨æˆ‘ä»¬çš„ GitHub å­˜å‚¨åº“ä¸­æ‰¾åˆ°é¡¹ç›®æ–‡ä»¶ [https://github.com/JavaTutorialNetwork/Tutorials/tree/master/FileUploaderJavaClient](https://github.com/JavaTutorialNetwork/Tutorials/tree/master/FileUploaderJavaClient)

è°¢è°¢é˜…è¯»ã€‚ ä¸€å¦‚æ—¢å¾€æ¬¢è¿è¯„è®ºğŸ™‚